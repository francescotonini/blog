<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=author content="Francesco Tonini"><meta name=description content="How to configure an Hyper-V virtual machine running Ubuntu 20.04 desktop with enhanced session enabled."><meta name=keywords content="blog  thoughts  achievements  developer  student  ai  iot  ios  android  app  csharp  c  c++  nodejs  dotnet  windowsphone  windows  deeplearning  machinelearning  trackbot  pricetrackbot  botfactory  botfactoryit  javascript  linux  telegram  apple  univraule  univrorari  bot  unitn  univr"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to install Ubuntu 20.04 on Hyper-V with enhanced session"><meta name=twitter:description content="A few days ago Canonical officially released the latest version of Ubuntu. The first of the two releases of 2020 marks a new long term support (LTS).
This post aims at configuring an Hyper-V virtual machine running Ubuntu 20.04 desktop with enhanced session enabled. At the time of writing this the Hyper-V wizard of Windows 10 1909 supports Ubuntu 18.04 and 19.10, but we can easily bypass this limitation by installing the tools manually."><link rel=canonical href=https://tonini.dev/post/ubuntu-20-04-hyperv/><link media=screen rel=stylesheet href=https://tonini.dev/css/common.css><link media=screen rel=stylesheet href=https://tonini.dev/css/content.css><link media=screen rel=stylesheet href=https://tonini.dev/css/highlight.css><title>How to install Ubuntu 20.04 on Hyper-V with enhanced session - Francesco Tonini</title><link rel=stylesheet href=https://tonini.dev/css/single.css></head><body><div id=wrapper><header id=header><h1><a href=https://tonini.dev>Francesco Tonini</a></h1><nav><span class=nav-bar-item><a class=link href=/>Post</a></span>
<span class=nav-bar-item><a class=link href=/post/>Archives</a></span>
<span class=nav-bar-item><a class=link href=/about/>About</a></span></nav></header><main id=main class=post><h1>How to install Ubuntu 20.04 on Hyper-V with enhanced session</h1><div><b>Keywords:</b>
<a class=link href=https://tonini.dev/tags/ubuntu>#ubuntu</a>
<a class=link href=https://tonini.dev/tags/20.04>#20.04</a>
<a class=link href=https://tonini.dev/tags/lts>#lts</a>
<a class=link href=https://tonini.dev/tags/hyperv>#hyperv</a>
<a class=link href=https://tonini.dev/tags/windows10>#windows10</a>
<a class=link href=https://tonini.dev/tags/installation>#installation</a>
<a class=link href=https://tonini.dev/tags/vm>#vm</a></div><div class=content><p>A few days ago Canonical officially released the latest version of Ubuntu. The first of the two releases of 2020 marks a new long term support (LTS).</p><p>This post aims at configuring an Hyper-V virtual machine running Ubuntu 20.04 desktop with enhanced session enabled. At the time of writing this the Hyper-V wizard of Windows 10 1909 supports Ubuntu 18.04 and 19.10, but we can easily bypass this limitation by installing the tools manually.</p><h1 id=create-vm>Create VM</h1><p>Open the <em>Hyper-V Manager</em> and on the right panel click on <em>New</em>, then <em>Virtual Machine</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step1.png></figure><p>A new window will appear. Choose an appropriate name for your VM and click <em>Next</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step2.png></figure><p>Make sure you select <em>Generation 2</em> on the next page. This will ensure that UEFI is enabled. Then, click <em>Next</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step3.png></figure><p>As for the amount of memory, 4GB is the minimum requirement for a good experience. I suggest you to go to 8GB if you can. Then, click <em>Next</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step4.png></figure><p>Be sure to select at least one network interface so that Ubuntu can download updates while installing and later on we can download drivers too. Then, click <em>Next</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step5.png></figure><p>By default the wizard will create a 127GB disk. For my purpose that amount of storage is enough. Then, you guessed it, click <em>Next</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step6.png></figure><p>Last but not least, select the ISO downloaded from the <a href=https://ubuntu.com/>Ubuntu website.</a> To end the wizard, click on <em>Finish</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step7.png></figure><p>Before you can start the VM, we have to disable secure boot as Ubuntu doesn&rsquo;t support it. Select the VM, then on the right panel click <em>Settings</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step8.png></figure><p>On the left panel click <em>Security</em> and make sure that <em>Enable secure boot</em> is unchecked. Then, click <em>Ok</em>.</p><figure><img src=/images/ubuntu-20-04-hyperv/step9.png></figure><p>We are now ready to start the VM and run the OS setup (remember to <strong>disable auto-login</strong>, otherwise the enhanced session won&rsquo;t work). Once you have finished, we can start installing the <em>linux-tools</em> provided by Microsoft.</p><h1 id=setup-enhanced-session>Setup enhanced session</h1><p>On Ubuntu, open a terminal, download and run the setup script.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>wget https://raw.githubusercontent.com/Microsoft/linux-vm-tools/master/ubuntu/18.04/install.sh
sudo chmod +x install.sh
sudo ./install.sh
</code></pre></div><p>If you receive an error at the end of the install script, there is one more thing to do. Using your favorite editor, open <strong>/etc/xrdp/xrdp.ini</strong> (sudo required) and edit the following lines:</p><pre><code>port=vsock://-1:3389
use_vsock=false
</code></pre><p>Save the file and shutdown the VM. From Windows, open a PowerShell prompt with admin privileges and type:</p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=nb>Set-VM</span> <span class=n>-VMName</span> <span class=p>&lt;</span><span class=n>your_vm_name</span><span class=p>&gt;</span>  <span class=n>-EnhancedSessionTransportType</span> <span class=n>HvSocket</span>
</code></pre></div><p>where <em>&lt;your_vm_name></em> is, well, the name of the VM (the one chosen at the start of the creation wizard).
There you go! Now start the VM and in a matter of seconds you will be redirected to the XRDP login page.</p><p><img src=/images/ubuntu-20-04-hyperv/step10.png alt="Step 10"></p></div><div class=paginator><a class=link href=https://tonini.dev/post/hashcode2020/>‚Üê prev</a>
<a></a></div><div class=comment></div></main><footer id=footer><div><span>¬© 2019</span> - <span>2020</span></div><div><span>Powered by</span>
<a class=link href=https://gohugo.io/>Hugo</a>
<span>üç¶ Theme</span>
<a class=link href=https://github.com/queensferryme/hugo-theme-texify>TeXify</a></div><div class=footnote><span>Follow me on <a class=link href=https://github.com/francescotonini>GitHub</a> or <a class=link href=https://twitter.com/toninifrancesco>Twitter</a> | <a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed target=_blank rel=noopener>CC BY-NC-SA 4.0</a></span></div></footer></div><link media=screen rel=stylesheet href=https://tonini.dev/css/main.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-84358665-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>